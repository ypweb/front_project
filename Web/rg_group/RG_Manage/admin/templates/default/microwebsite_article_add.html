<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<title>荣格集团</title>
<link id="cssfile2" rel="stylesheet" type="text/css" href="css/skin_1.css"/>
<link rel="stylesheet" type="text/css" href="../../../resource/kindeditor/themes/default/default.css"/>
<script type="text/javascript" src="../../../resource/js/jquery.js"></script>
<script type="text/javascript" src="../../../resource/js/jquery.validation.min.js"></script>
<script type="text/javascript" src="../../../resource/js/admincp.js"></script>
<script type="text/javascript" src="../../../resource/js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../resource/kindeditor/kindeditor-min.js"></script>
<script type="text/javascript" src="../../../resource/kindeditor/lang/zh_CN.js"></script>
<script type="text/javascript" src="../../../resource/js/fileupload/jquery.iframe-transport.js"></script>
<script type="text/javascript" src="../../../resource/js/fileupload/jquery.ui.widget.js"></script>
<script type="text/javascript" src="../../../resource/js/fileupload/jquery.fileupload.js"></script>
<script type="text/javascript" src="../../../resource/js/common.js"></script>
<script type="text/javascript">
cookie_skin = $.cookie("MyCssSkin");
if (cookie_skin) {
	$('#cssfile2').attr("href","css/"+ cookie_skin +".css");
}
</script>
</head>
<body>
<div id="append_parent"></div>
<div id="ajaxwaitid"></div>
<div class="page"> 
  <!-- 文章管理主题信息 -->
  <div class="fixed-bar">
    <div class="item-title">
      <h3>文章管理</h3>
      <ul class="tab-base">
        <li> <a href="microwebsite_article.html" target="workspace"> <span>文章列表</span> </a> </li>
        <li> <a class="current" href="javascript:void(0);"> <span>编辑</span> </a> </li>
      </ul>
    </div>
  </div>
  <div class="fixed-empty"></div>
  <!-- 文章编辑 -->
  <form id="article_form" method="post">
    <input type="hidden" name="form_submit" value="ok" />
    <table class="table tb-type2">
      <tbody>
        <tr class="noborder">
          <td colspan="2" class="required"><label class="validation" for="ac_title">文章标题:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform"><input type="text" value="" name="ac_title" id="ac_title" class="txt"></td>
          <td class="vatop tips"></td>
        </tr>
        <tr>
          <td colspan="2" class="required"><label class="validation" for="ac_parent_id">所属栏目:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform">
          	<select name="ac_parent_id" id="ac_parent_id">
              <option selected="selected" value="">文章标题</option>
                <option value="">所属分类</option>
                <option value="">微网站名称</option>
                <option value="">文章标题</option>
                <option value="">发起人</option>
                <option value="">添加时间</option>
            </select>
          </td>
          <td class="vatop tips"></td>
        </tr>
        <tr>
          <td colspan="2" class="required"><label for="ac_sort">排序:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform"><input type="text" value="" name="ac_sort" id="ac_sort" class="txt"></td>
          <td class="vatop tips"></td>
        </tr>
        <tr>
          <td colspan="2" class="required"><label for="fileupload">缩略图上传:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform" colspan="2"><input id="fileupload" type="file" name="fileupload" multiple="multiple"></td>
        </tr>
        <tr>
        	<td class="required" colspan="2">已传图片:</td>
        </tr>
        <tr style="background: none repeat scroll 0% 0% rgb(255, 255, 255);">
        	<td colspan="2">
          	<ul id="thumbnails" class="thumblists"> </ul>
          	<div class="tdare"></div>
        	</td>
        </tr>
        <tr>
          <td colspan="2" class="required"><label class="validation" for="ac_author">作者:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform"><input type="text" value="" name="ac_author" id="ac_author" class="txt"></td>
          <td class="vatop tips"></td>
        </tr>
        <tr>
          <td colspan="2" class="required"><label for="ac_source">来源:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform"><input type="text" value="" name="ac_source" id="ac_source" class="txt"></td>
          <td class="vatop tips"></td>
        </tr>
        <tr>
          <td colspan="2" class="required"><label>置顶:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform onoff">
            <label class="cb-enable selected" for="ac_topshow1">
            	<span>是</span>
            </label>
            <label class="cb-disable" for="ac_topshow0">
            	<span>否</span>
            </label>
            <input id="ac_topshow1" type="radio" value="1" checked="checked" name="ac_topshow" />
            <input id="ac_topshow0" type="radio" value="0" name="ac_topshow" />
					</td>
          <td class="vatop tips"></td>
        </tr>
        <tr>
          <td colspan="2" class="required"><label for="ac_keyword">关键词:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform"><input type="text" value="" name="ac_keyword" id="ac_keyword" class="txt"></td>
          <td class="vatop tips"></td>
        </tr>        
        <tr>
          <td colspan="2" class="required"><label>状态:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform">
          	<input id="ac_stateactive" type="radio" checked="checked" value="1" name="ac_state">
						<label for="ac_stateactive">激活</label>
            <input id="ac_statedisabled" type="radio" value="0" name="ac_state">
						<label for="ac_statedisabled">禁止</label>
          </td>
          <td class="vatop tips"></td>
        </tr>
        <tr>
          <td colspan="2" class="required"><label for="ac_info">文章简介:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform"><textarea name="ac_info" id="ac_info" class="tarea"></textarea></td>
          <td class="vatop tips"></td>
        </tr>
        <tr>
          <td colspan="2" class="required"><label class="validation">文章内容:</label></td>
        </tr>
        <tr class="noborder">
          <td class="vatop rowform">
          	<textarea id="ac_content" style="width:800px;height:400px;visibility:hidden;" name="ac_content" class="tarea"></textarea>
          </td>
          <td class="vatop tips"></td>
        </tr>
      </tbody>
      <tfoot>
        <tr class="tfoot">
          <td colspan="2" ><a href="JavaScript:void(0);" class="btn" id="submitBtn"><span>提交</span></a></td>
        </tr>
      </tfoot>
    </table>
  </form>
</div>
</body>
<script>
	var editor;
	KindEditor.ready(function(K) {
		editor = K.create('#ac_content', {
			allowFileManager : true
		});
	});
	
	$(function() {
		//按钮先执行验证再提交表单
		$("#submitBtn").click(function() {
			if ($("#article_form").valid()) {
				$("#article_form").submit();
			}
		});
		
		
		$('#article_form').validate({
			errorPlacement: function(error, element) {
				error.appendTo(element.parent().parent().prev().find('td:first'));
			},
			rules: {
				ac_title: {
					required: true
				},
				ac_author: {
					required: true
				},
				ac_content: {
					required:function(){
						return editor.isEmpty();
					}
				}
			},
			messages: {
				ac_title: {
					required: '文章标题不能为空'
				},
				ac_author: {
					required: '文章作者不能为空'
				},
				ac_content: {
					required: '文章内容不能为空'
				}
			}
		});
		// 图片上传
		$('#fileupload').each(function() {
			$(this).fileupload({
				dataType: 'json',
				url: '',
				done: function(e, data) {
					if (data != 'error') {
						add_uploadedfile(data.result);
					}
				}
			});
		});
	});
	
	function add_uploadedfile(file_data) {
		var newImg = '<li id="' + file_data.file_id + '" class="picture"><input type="hidden" name="file_id[]" value="' + file_data.file_id + '" /><div class="size-64x64"><span class="thumb"><i></i><img src="http://dianshangkaifa.szrgsh.com/data/upload/shop/article/' + file_data.file_name + '" alt="' + file_data.file_name + '" width="64px" height="64px"/></span></div><p><span><a href="javascript:insert_editor(\'http://dianshangkaifa.szrgsh.com/data/upload/shop/article/' + file_data.file_name + '\');">插入</a></span><span><a href="javascript:del_file_upload(' + file_data.file_id + ');">删除</a></span></p></li>';
		$('#thumbnails').prepend(newImg);
	}
	
	function insert_editor(file_path) {
		KE.appendHtml('article_content', '<img src="' + file_path + '" alt="' + file_path + '">');
	}
	
	function del_file_upload(file_id) {
		if (!window.confirm('您确定要删除吗?')) {
			return;
		}
		$.getJSON('index.php?act=article&op=ajax&branch=del_file_upload&file_id=' + file_id, function(result) {
			if (result) {
				$('#' + file_id).remove();
			} else {
				alert('删除失败');
			}
		});
	}

	
	
	
	
</script>
</html>